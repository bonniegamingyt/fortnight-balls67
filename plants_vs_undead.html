<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mini PvZ Game</title>
<style>
  body { margin: 0; font-family: sans-serif; background: #88cc88; }
  h1 { text-align:center; }
  #game { position: relative; width: 800px; height: 400px; margin: 20px auto; background: #aaeebb; border: 2px solid #333; }
  .cell { width: 80px; height: 80px; float: left; border: 1px solid #77aa77; box-sizing: border-box; position: relative; }
  .plant, .zombie, .bullet, .lawnmower { position: absolute; }
  .plant { width: 60px; height: 60px; background: green; border-radius: 10px; }
  .zombie { width: 60px; height: 70px; background: gray; border-radius: 10px; }
  .bullet { width: 10px; height: 5px; background: yellow; }
  .lawnmower { width: 70px; height: 50px; background: silver; border-radius: 50%; }
  #menu { text-align:center; margin:10px; }
  .menu-btn { padding:5px 10px; margin:0 5px; cursor:pointer; background: #88cc88; border:1px solid #333; border-radius:5px; }
</style>
</head>
<body>
<h1>Mini PvZ Game</h1>
<div id="menu">
  <button class="menu-btn" onclick="selectPlant('peashooter')">Peashooter</button>
  <button class="menu-btn" onclick="selectPlant('sunflower')">Sunflower</button>
</div>
<div id="game"></div>

<script>
const game = document.getElementById('game');
const rows = 5;
const cols = 10;
const grid = [];
let selectedPlant = 'peashooter';
const plants = [];
const zombies = [];
const bullets = [];
const lawnmowers = [];

// Create lawn grid
for(let r=0;r<rows;r++){
    grid[r] = [];
    for(let c=0;c<cols;c++){
        const cell = document.createElement('div');
        cell.className='cell';
        cell.dataset.row=r;
        cell.dataset.col=c;
        cell.addEventListener('click',()=>placePlant(r,c));
        game.appendChild(cell);
        grid[r][c]=cell;
    }
}

// Place plant
function placePlant(row,col){
    if(grid[row][col].querySelector('.plant')) return;
    const plant = document.createElement('div');
    plant.className='plant';
    plant.style.left = grid[row][col].offsetLeft+10+'px';
    plant.style.top = grid[row][col].offsetTop+10+'px';
    plant.dataset.type=selectedPlant;
    plant.health=3;
    game.appendChild(plant);
    plants.push(plant);
}

// Plant selection
function selectPlant(type){ selectedPlant=type; }

// Spawn zombie
function createZombie(row){
    const zombie = document.createElement('div');
    zombie.className='zombie';
    zombie.style.left='760px';
    zombie.style.top=(row*80+10)+'px';
    zombie.health=5;
    zombie.dataset.row=row;
    game.appendChild(zombie);
    zombies.push(zombie);
}

// Spawn lawnmowers
for(let r=0;r<rows;r++){
    const lm = document.createElement('div');
    lm.className='lawnmower';
    lm.style.left='0px';
    lm.style.top=r*80+15+'px';
    lm.active=true;
    game.appendChild(lm);
    lawnmowers.push(lm);
}

// Shoot bullets from plants
function shootBullet(plant){
    const bullet = document.createElement('div');
    bullet.className='bullet';
    bullet.style.left = parseInt(plant.style.left)+60+'px';
    bullet.style.top = parseInt(plant.style.top)+28+'px';
    bullets.push({el:bullet,row:Math.floor(parseInt(plant.style.top)/80)});
    game.appendChild(bullet);
}

// Game loop
function gameLoop(){
    // Zombies move
    zombies.forEach((zombie,zi)=>{
        zombie.style.left=parseInt(zombie.style.left)-1+'px';
        const row=parseInt(zombie.dataset.row);
        // Check collision with plants
        plants.forEach((plant,pi)=>{
            if(Math.abs(parseInt(zombie.style.left)-parseInt(plant.style.left))<50 &&
               Math.abs(parseInt(zombie.style.top)-parseInt(plant.style.top))<50){
                plant.health--;
                if(plant.health<=0){
                    plant.remove();
                    plants.splice(pi,1);
                }
            }
        });
        // Activate lawnmower if zombie reaches start
        if(parseInt(zombie.style.left)<=0){
            if(lawnmowers[row].active){
                lawnmowers[row].active=false;
                zombies.splice(zi,1);
                zombie.remove();
            } else {
                alert('Game Over!');
                location.reload();
            }
        }
    });

    // Move bullets
    bullets.forEach((b,bi)=>{
        b.el.style.left=parseInt(b.el.style.left)+5+'px';
        zombies.forEach((zombie,zi)=>{
            if(zombie.dataset.row==b.row &&
               Math.abs(parseInt(b.el.style.left)-parseInt(zombie.style.left))<50){
                zombie.health--;
                b.el.remove();
                bullets.splice(bi,1);
                if(zombie.health<=0){
                    zombie.remove();
                    zombies.splice(zi,1);
                }
            }
        });
    });

    // Plants shoot bullets
    plants.forEach(plant=>{
        if(plant.dataset.type=='peashooter'){
            if(Math.random()<0.02) shootBullet(plant);
        }
    });

    requestAnimationFrame(gameLoop);
}

setInterval(()=>{createZombie(Math.floor(Math.random()*rows));},2000);
gameLoop();
</script>
</body>
</html>
